# hax自动枪机脚本（Tampermonkey / Greasemonkey）

> **功能概览**  
> - 常驻设置面板（密码、系统索引、数据中心为空时刷新延迟、目标数据中心、缓存、开始/暂停）  
> - 自动填写 **密码、系统、用途、协议**（不受页面刷新影响）  
> - **数据中心**：若列表只有占位项则在用户设定的延迟后刷新页面；若不为空则不刷新，默认选最后一个。对 **hax** 页面可根据下拉框文字（`US‑OpenVZ‑3、US‑OpenVZ‑2、EU‑1`）定位对应索引，若未匹配仍使用最后一个；**woiden** 则始终选最后一个。  
> - **woiden** 自动算术验证码（使用你提供的 `extractNumber`，运算符直接取 `nextSibling.textContent.trim()`）  
> - 自动检测 Cloudflare Turnstile（`cf‑turnstile-response`），获取 token 后点击提交按钮（XPath）  
> - **缓存**：勾选后把面板全部配置写入 `localStorage`，下次打开页面自动恢复  
> - **开始 / 暂停**：一键切换，暂停时立即停止所有计时器（CF 轮询、数据中心刷新计时器），页面保持当前状态  

---

## 目录

1. [安装方式](#安装方式)  
2. [脚本概览](#脚本概览)  
3. [面板说明](#面板说明)  
4. [使用步骤](#使用步骤)  
5. [常见问题 (FAQ)](#常见问题-faq)  
6. [许可证](#许可证)  

---

## 安装方式

1. **安装油猴插件**  
   - **Chrome / Edge**：前往 Chrome Web Store，搜索并安装 **Tampermonkey**。  
   - **Firefox**：前往 Add‑ons 网站，搜索并安装 **Tampermonkey**（或 **Greasemonkey**，二者皆可）。  

2. **安装脚本**

<div align="center">
  <a href="https://github.com/lvqopl/hax-auto-create-vps/raw/refs/heads/main/hax-auto-create.user.js" style="text-decoration:none;">
    <img src="https://img.shields.io/badge/点击安装或更新-脚本-blue?style=for-the-badge&logo=tampermonkey" alt="Install Script">
  </a>
</div>

   - 点击浏览器右上角的 Tampermonkey 图标 → 选择 **“创建新脚本”**。  
   - 删除编辑器中出现的默认模板，**完整粘贴下面的 Userscript 代码**（包含 `// ==UserScript==` 开头的所有内容）。  



3. **保存并启用**  
   - 按 `Ctrl + S`（或编辑器左上角的保存图标）保存脚本。  
   - 确认 Tampermonkey 面板左侧的开关为 **ON**（绿色），表示脚本已激活。  

> **提示**：如果你使用 **Greasemonkey**，同样复制粘贴脚本后点“保存”。  

---

## 脚本概览

| 站点 | 关键操作 |
|------|----------|
| `hax.co.id/create-vps/*` | 1️⃣ 自动填写密码、系统、用途、协议  <br>2️⃣ 根据面板所选文字（`US‑OpenVZ‑3`、`US‑OpenVZ‑2`、`EU‑1`）定位对应的数据中心索引（若未匹配则使用最后一个） |
| `woiden.id/create-vps/*` | 1️⃣ 自动填写密码、系统、用途、协议 <br>2️⃣ 永远选列表中的 **最后一个** 数据中心 <br>3️⃣ 计算算术验证码（`extractNumber` + `nextSibling` 运算符）并填入 `#captcha` |
| **两站点通用** | • 当 `#datacenter` 只剩占位项（列表长度为 1）时，使用面板设定的 **刷新延迟**（默认 5 秒）自动 `location.reload()` <br>• 自动轮询 Cloudflare Turnstile，获取 token 后点击提交按钮（XPath） <br>• 支持 **开始 / 暂停** 与 **缓存**（面板中的所有配置） |

---

## 面板说明

面板固定在页面右上角（不折叠），包含以下控件：

| 控件 | 说明 | 默认值 |
|------|------|--------|
| **密码** `#vps-pwd` | 填入 VPS 创建表单的密码字段 | `123456` |
| **系统索引 (0 起始)** `#vps-os-index` | 选中系统 `<select id="os">` 的索引（`0` 为第一项） | `2`（即第 3 项） |
| **数据中心为空时刷新延迟（ms）** `#vps-dc-delay` | 当数据中心下拉框只有占位项时，延迟多少毫秒后自动刷新页面 | `5000`（5 秒） |
| **目标数据中心** `#vps-dc-choice`（仅 hax） | 文字匹配后自动定位索引。可选：`US‑OpenVZ‑3`、`US‑OpenVZ‑2`、`EU‑1`。若留空则使用 **最后一个** 选项 | 空（使用默认） |
| **缓存设置** `#vps-cache-toggle` | 勾选后当前面板的所有值会写入 `localStorage`，下次打开页面自动恢复 | 未勾选 |
| **开始自动化 / 暂停** `#vps-start-pause-btn` | 切换运行状态。**开始** 时立即执行所有自动化步骤；**暂停** 时会停止所有计时器（CF 轮询、刷新计时器） | 文本显示 “开始自动化” |

> **注意**  
> - **密码** 为明文，仅用于演示。  
> - **系统索引** 与页面中的 `<select id="os">` 直接对应，**0** 为第一项。  
> - **目标数据中心** 只对 **hax** 页面有效，**woiden** 永远使用最后一个选项。  

---

## 使用步骤

1. **打开 VPS 创建页面**  
   - 访问 `https://hax.co.id/create-vps/...` 或 `https://woiden.id/create-vps/...`。  

2. **填写面板**  
   - 根据需要修改 **密码、系统索引、刷新延迟**（若想更快/更慢刷新）以及 **目标数据中心**（仅 hax）。  
   - 如希望下次自动恢复，勾选 **缓存设置**。  

3. **点击 “开始自动化”**  
   - 按钮文字会变成 **“暂停”**，脚本将依次执行：<br>① 填写密码、系统、用途、协议。<br>② 处理数据中心（空列表 → 延迟刷新；不空 → 按目标文字或默认最后一个）。<br>③ 对 woiden：计算并填入算术验证码。<br>④ 启动 Cloudflare Turnstile 轮询，获取 token 后自动点击提交按钮。  

4. **暂停（如需）**  
   - 再次点击 **“暂停”**，所有计时器立即清除，页面保持当前状态，不再进行任何自动操作。  

> **示例**：在 **hax** 页面想使用 `US‑OpenVZ‑2`，只需在面板的 **目标数据中心** 里选择 `US‑OpenVZ‑2`，点击 **开始自动化** 即可。若页面的下拉列表里没有该文字，脚本仍会使用最后一个选项。

---

## 常见问题 (FAQ)

| 问题 | 解答 |
|------|------|
| **面板没有出现** | 确认脚本已在 Tampermonkey 左侧开启（绿色）。如果页面使用了 **iframe**，请在对应子页面中再次启用脚本（Tampermonkey 会在右上角弹出 “在此页面启用”）。 |
| **数据中心一直刷新** | 只有当 `<select id="datacenter">` 仅剩一个占位选项时才会刷新。检查页面是否真的只剩占位项；若 `#vps-dc-delay` 设为 `0`，会导致立即刷新。 |
| **算术验证码始终为 0** | 确认验证码图片的 URL 符合 `-数字.` 或 `-数字:` 形式（例如 `…/captcha-7.png`）。如果 URL 结构不同，需要自行修改 `extractNumber` 中的解析逻辑。 |
| **运算符总是 “+”** | 现在脚本已经恢复为 `images[0].nextSibling.textContent.trim()`，如果页面结构在图片后面有换行或空节点导致取不到，请在 **开发者工具 → Elements** 检查 `<img>` 与运算符之间的节点结构。 |
| **提交按钮没有被点击** | 脚本先尝试通过 XPath 找到按钮，若页面结构更改导致 XPath 失效，会回退到 `form button[type="submit"], form button`。如果仍找不到，请在控制台执行 `document.querySelector('form button')` 检查是否能定位，然后自行修改脚本中的 XPath。 |
| **想让脚本在页面刷新后自动继续运行** | 脚本已经实现：刷新后会读取缓存并自动恢复运行状态（如果之前是“运行中”）。只要 **缓存** 已勾选且 **状态** 为 “运行中”，刷新后脚本会自动继续。 |
| **如何修改默认值（如默认刷新延迟）** | 打开脚本编辑器（Tampermonkey → 本脚本 → 编辑），在 `loadPanelValues()` 或面板 `innerHTML` 中修改对应的默认数值，保存后刷新页面即可生效。 |
| **脚本报错 `Uncaught TypeError: Cannot read property 'value' of null`** | 说明某个页面元素（如 `#os`、`#password` 等）在当前页面不存在。请确认你打开的是 **`create-vps`** 页面，而不是其他路径。若页面结构已更新，需要手动把脚本里对应的选择器改成新页面上的 ID/类名。 |

---

## 许可证

本脚本采用 **MIT 许可证**。你可以自由使用、修改、再分发此代码，唯一要求是保留原始版权声明与许可信息。

---  

*如果还有其他需求或遇到任何问题，欢迎在项目的 Issues 中提出，我会及时跟进。祝使用愉快 🚀!*
